import{aT as y,a$ as $,b1 as x,aX as f,b3 as s,b4 as i,be as c,b9 as P,cG as T,cz as S,d5 as I,d6 as N,bR as n,bm as E,dx as k,dy as u,dp as j,dz as B,d7 as D,dA as C,d3 as m,dB as V,dr as X,dC as L,b2 as p,bb as r,b0 as b,by as d}from"./C0jZ-yIj.js";import{d as M}from"./BpQt0zxb.js";(function(){try{var e=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},t=new e.Error().stack;t&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[t]="02c3b2fd-88af-48df-a738-781cf8881632",e._sentryDebugIdIdentifier="sentry-dbid-02c3b2fd-88af-48df-a738-781cf8881632")}catch{}})();const U=y({name:"app-export-progress-preloader",props:{progress:{type:Number,required:!0}},data:()=>({circleRadius:56.400001525878906}),computed:{circumference(){return 2*Math.PI*this.circleRadius},strokeDashoffset(){return(1-this.progress/100)*this.circumference}},mounted(){this.updateCircleRadius()},methods:{updateCircleRadius(){this.circleRadius=this.$refs.circle.getBBox().width/2}}}),q={class:"app-export-progress-preloader"},z={class:"app-export-progress-preloader__svg"},G={class:"app-export-progress-preloader-svg",width:"100%",height:"100%"},F=["stroke-dasharray","stroke-dashoffset"],W={class:"app-export-progress-preloader__number"};function K(e,t,l,o,a,_){return x(),f("div",q,[s("div",z,[(x(),f("svg",G,[t[0]||(t[0]=s("circle",{class:"app-export-progress-preloader-svg__background",cx:"50%",cy:"50%",r:"47%","stroke-width":"8"},null,-1)),s("circle",{ref:"circle",class:"app-export-progress-preloader-svg__value",cx:"50%",cy:"50%",r:"47%","stroke-width":"8","stroke-linecap":"round","stroke-dasharray":e.circumference,"stroke-dashoffset":e.strokeDashoffset},null,8,F)]))]),s("div",W,i(e.progress)+"% ",1)])}const H=$(U,[["render",K]]),Y=y({name:"app-export-progress-layout"}),J={class:"app-export-progress-layout"},Q={class:"app-export-progress-layout__preloader"},Z={class:"app-export-progress-layout__title"},ee={class:"app-export-progress-layout__subtitle"},te={class:"app-export-progress-layout__cancel-button"};function oe(e,t,l,o,a,_){return x(),f("div",J,[s("div",Q,[c(e.$slots,"preloader")]),s("div",Z,[c(e.$slots,"title")]),s("div",ee,[c(e.$slots,"subtitle")]),s("div",te,[c(e.$slots,"cancel-button")])])}const re=$(Y,[["render",oe]]),se=y({name:"app-modal-content-cancel-export"}),ne={class:"app-modal-content-cancel-export"},ae={class:"app-modal-content-cancel-export__title"},pe={class:"app-modal-content-cancel-export__subtitle"},ie={class:"app-modal-content-cancel-export__buttons"},ce={class:"app-modal-content-cancel-export__button-left"},le={class:"app-modal-content-cancel-export__button-right"};function de(e,t,l,o,a,_){return x(),f("div",ne,[s("div",ae,[c(e.$slots,"title")]),s("div",pe,[c(e.$slots,"subtitle")]),s("div",ie,[s("div",ce,[c(e.$slots,"left-button")]),s("div",le,[c(e.$slots,"right-button")])])])}const ue=$(se,[["render",de]]),_e=M({name:"page-export-progress",components:{AppButton:P,AppOverlay:T,AppModal:S},async asyncData(){let e,t;if(I().currentRoute.value.query.runNewExport!==void 0)return{};const{$container:o}=N(),{project:a}=o.get(n.STORE_SERVICE).state;E(a!==void 0,"project is undefined");const _=o.get(n.CONTEXT_SERVICE);try{const{result:g,status:h}=([e,t]=k(()=>o.get(n.EXPORT_PROCESS_INTERACTOR).getExportState(a.id)),e=await e,t(),e);switch(h){case u.CANCELLED:case u.EMPTY:throw new D;case u.ERROR:throw new B;case u.IN_PROGRESS:return{};case u.DONE:return E(g!==void 0,"result is undefined"),j({name:"export-result",params:{projectId:a.id}}),{}}}catch(g){return _.showGlobalErrorOverlay(g),{}}},data(){return{exportProgress:1,exportPageOverlay:void 0,exportAbortController:new C,exportAwaitResultAbortController:new C,isExportCompleted:!1}},computed:{projectId(){return this.$store.getters.projectId},projectTitle(){return this.$store.getters.projectTitle}},async beforeMount(){try{const{project:e}=this.$container.get(n.STORE_SERVICE).state;E(e!==void 0,"project is undefined");const t=(this._.provides[m]||this.$route).query.runNewExport!==void 0,l=o=>{this.exportProgress=o};if(t){const{status:o}=await this.$container.get(n.EXPORT_PROCESS_INTERACTOR).getExportState(e.id);o===u.IN_PROGRESS&&await this.$container.get(n.EXPORT_PROCESS_INTERACTOR).cancelExport(e.id),await this.$container.get(n.EXPORT_PROCESS_INTERACTOR).execute(this.exportAbortController,e.id)}try{await this.$container.get(n.EXPORT_AWAIT_RESULT_INTERACTOR).execute(l,this.exportAwaitResultAbortController,e.id),this.isExportCompleted=!0}catch(o){if(o instanceof V&&!this.exportAwaitResultAbortController.signal.aborted){const a=this.$container.get(n.CONTEXT_SERVICE);X(a.backendBaseUrl);return}throw o}this.$router.replace({name:"export-result",params:{projectId:e.id}})}catch(e){e instanceof L||(this.$container.get(n.CONTEXT_SERVICE).showGlobalErrorOverlay(e),this.$container.get(n.EXCEPTION_HANDLER_SERVICE).handle(e))}},async mounted(){const{project:e}=this.$container.get(n.STORE_SERVICE).state;E(e!==void 0,"project is undefined"),(this._.provides[m]||this.$route).query.runNewExport!==void 0&&await this.$router.replace({name:"export-progress",params:{projectId:e.id},query:{...(this._.provides[m]||this.$route).query,runNewExport:void 0}})},beforeUnmount(){this.isExportCompleted||this.cancelExportProcess()},methods:{setExportPageOverlay(e){this.exportPageOverlay=e},async cancelExportProcess(){this.exportAbortController.abort(),this.exportAwaitResultAbortController.abort();const{project:e}=this.$container.get(n.STORE_SERVICE).state;E(e!==void 0,"project is undefined"),await this.$router.push({name:"editor",params:{projectId:e.id}})}}},"$0R15WKmLvO"),ge={class:"export-progress"},he={class:"app-modal-content-cancel-export__text-bold"};function Ee(e,t,l,o,a,_){const g=H,h=b("AppButton"),w=re,R=b("AppOverlay"),O=ue,A=b("AppModal");return x(),f("div",ge,[p(R,null,{default:r(()=>[p(w,null,{preloader:r(()=>[p(g,{progress:e.exportProgress},null,8,["progress"])]),title:r(()=>[d(i(e.$t("export.exporting"))+"... ",1)]),subtitle:r(()=>[d(i(e.$t("export.contentProcessed")),1)]),"cancel-button":r(()=>[p(h,{variant:"gray",size:"large","font-weight":500,"rounding-value":6,onClick:t[0]||(t[0]=v=>e.setExportPageOverlay("cancel-export-process"))},{default:r(()=>[d(i(e.$t("cancel")),1)]),_:1})]),_:1})]),_:1}),p(R,{"is-visible":e.exportPageOverlay==="cancel-export-process",variant:"modal"},{default:r(()=>[p(A,{"is-expand-on-mobile":!0,onClose:t[3]||(t[3]=v=>e.setExportPageOverlay(void 0))},{default:r(()=>[p(O,null,{title:r(()=>[d(i(e.$t("export.cancelExport")),1)]),subtitle:r(()=>[s("span",he,i(e.$t("warning").toUpperCase())+":",1),d(" "+i(e.$t("export.progressWillBeLost")),1)]),"left-button":r(()=>[p(h,{variant:"outline",size:"modal","font-weight":600,"rounding-value":6,onClick:t[1]||(t[1]=v=>e.setExportPageOverlay(void 0))},{default:r(()=>[d(i(e.$t("export.noKeepExporting")),1)]),_:1})]),"right-button":r(()=>[p(h,{variant:"error",size:"modal","font-weight":600,"rounding-value":6,onClick:t[2]||(t[2]=v=>{e.setExportPageOverlay(void 0),e.cancelExportProcess()})},{default:r(()=>[d(i(e.$t("export.yesCancelExport")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["is-visible"])])}const $e=$(_e,[["render",Ee]]);export{$e as default};
//# sourceMappingURL=BsplJI9y.js.map
